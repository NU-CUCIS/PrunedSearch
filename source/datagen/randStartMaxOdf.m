% Copyright (C) 2016, Northwestern University
% See COPYRIGHT notice in top-level directory.
clear all
warning off
constraint = [0.0159822999947858,0.00818178632407973,0.00818178632407973,0.00818178632407973,0.00818178632407973,0.00818178632407973,0.00818178632407973,0.00613766636477021,0.00572645585112265,0.00572645585112265,0.00613766636477021,0.00572645585112265,0.00572645585112265,0.00572645585112265,0.00613766636477021,0.00572645585112265,0.00572645585112265,0.00572645585112265,0.00572645585112265,0.00572645585112265,0.00613766636477021,0.00572645585112265,0.00613766636477021,0.00572645585112265,0.00572645585112265,0.00572645585112265,0.00572645585112265,0.00572645585112265,0.00613766636477021,0.00613766636477021,0.00613766636477021,0.00376140480720866,0.00376140480720866,0.00376140480720866,0.00454084416782057,0.00454084416700527,0.00454084416700527,0.00454084416782057,0.00454084416782057,0.00454084416700527,0.00454084416782057,0.00454084416700527,0.00454084416700527,0.00454084416782057,0.00454084416700527,0.00454084416782057,0.00454084416782057,0.00454084416782057,0.00454084416782057,0.00454084416700527,0.00454084416700527,0.00454084416700527,0.00454084416700527,0.00454084416782057,0.00454084416700527,0.00454084416700527,0.00454084416782057,0.00454084416782057,0.00541192129558303,0.00495535011431222,0.00495535011431222,0.00541192129558303,0.00495535011431222,0.00541192129558303,0.00541192129558303,0.00541192129558303,0.00541192129558303,0.00541192129558303,0.00495535011431222,0.00541192129558303,0.00398197813454777,0.00398197813454777,0.00398197813454777,0.00398197813454777,0.00398197813454777,0.00398197813454777];

for i = 1:76
    ub(i,1) = 1/constraint(i);
end

for j = 1:10   
    for i = 1:76
        odf0(i,1) = rand(1,1)/constraint(i);
    end
    
    [odf(:,j),tempOpt] = fmincon(@materialOpt,odf0,[],[],constraint,1,zeros(76,1),ub);
    expOpt(j) = -tempOpt;
end

ind = find(expOpt == max(expOpt));
if length(ind) > 1
    ind = ind(1);
end
bestodf = odf(:,ind);
bestOpt = max(expOpt);

k = 1;
while bestOpt < 3.5810e-6 && k <10000
    odfnew0 = bestodf;
    ind2 = find(bestodf == max(bestodf));
    for i = 1:10
        odfnew0(ind2) = rand(1,1)/constraint(ind2);
        [odfnew(:,i),opt] = fmincon(@materialOpt,odfnew0,[],[],constraint,1,zeros(76,1),ub);
    end
    optnew(i) = -opt;
    ind3 = find(optnew == max(optnew));
    if length(ind3) > 1
        ind3 = ind3(1);
    end
    bestodf = odf(:,ind3);
    bestOpt = optnew(ind3);

    k = k + 1;
    
    if mod(k,1000) == 0
        clc
        display(k)
    end
end

    
    
    
    
